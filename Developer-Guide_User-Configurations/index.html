<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Armbian team" name="author"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>User Configurations - Armbian Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet"/>
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "User Configurations";
    var mkdocs_page_input_path = "Developer-Guide_User-Configurations.md";
    var mkdocs_page_url = null;
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-284946-9', 'docs.armbian.com');
      ga('send', 'pageview');
  </script>
</link><link href="../pdf/document.pdf" rel="alternate" title="PDF" type="application/pdf"/></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Armbian Documentation</a>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="..">Home</a>
</li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Getting-Started/">Getting Started</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Quick_facts/">Quick facts</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Basic-Troubleshooting/">Troubleshooting</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Advanced-Features/">Advanced Features</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Fine-Tuning/">Fine Tuning</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Armbian-Config/">Armbian config</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Allwinner_overlays/">Allwinner DT overlays</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Migration_from_Bananian/">Migration from Bananian</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Hardware Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner/">Allwinner (Generic)</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner-A20/">A10 and A20</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner-H3/">H2+ and H3</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner-H5-A64/">H5 and A64</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner-H6/">H6</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Freescale-imx6/">Freescale i.MX6</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Marvell/">Marvell Armada</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_Build-Preparation/">Building Armbian</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_Using-Vagrant/">Building with Vagrant</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_Building-with-Docker/">Building with Docker</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_Build-Options/">Build Options</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="./">User Configurations</a>
<ul class="current">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_FEL-boot/">FEL boot</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Contributor Process</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Process_Contribute/">Contribute</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Process_Merge-Policy/">Merge Policy</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Process_Documentation/">Documentation</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Release management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Process_Release-Model/">Model</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Release_Changelog/">Changelog</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Community_IRC/">IRC</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Armbian Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>Developer Guide »</li>
<li>User Configurations</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/armbian/documentation/edit/master/docs/Developer-Guide_User-Configurations.md"> Edit on Github</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h2 id="user-provided-patches">User provided patches<a class="headerlink" href="#user-provided-patches" title="Permanent link">¶</a></h2>
<p>You can add your own patches outside build script. Place your patches inside appropriate directory, for kernel or u-boot. There are no limitations except all patches must have file name extension <code>.patch</code>. User patches directory structure mirrors directory structure of <code>patch</code>. Look for the hint at the beginning of patching process to select proper directory for patches. Example:</p>
<pre><code>[ o.k. ] Started patching process for [ kernel sunxi-dev 4.4.0-rc6 ]
[ o.k. ] Looking for user patches in [ userpatches/kernel/sunxi-dev ]
</code></pre>
<p>Patch with same file name in <code>userpatches</code> directory tree substitutes one in <code>patch</code>. To <em>replace</em> a patch provided by Armbian maintainers, copy it from <code>patch</code> to corresponding directory in <code>userpatches</code> and edit it to your needs. To <em>disable</em> a patch, create empty file in corresponding directory in <code>userpatches</code>.</p>
<h2 id="user-provided-configuration">User provided configuration<a class="headerlink" href="#user-provided-configuration" title="Permanent link">¶</a></h2>
<p>If file <code>userpatches/lib.config</code> exists, it will be called and can override the particular kernel and u-boot versions. It can also add additional packages to be installed, by adding to <code>PACKAGE_LIST_ADDITIONAL</code>. For a comprehensive list of available variables, look through  <code>lib/configuration.sh</code>. Some examples of what you can change:</p>
<pre><code>PACKAGE_LIST_ADDITIONAL="$PACKAGE_LIST_ADDITIONAL python-serial python" # additional packages
[[ $LINUXFAMILY == sunxi64 &amp;&amp; $BRANCH == dev ]] &amp;&amp; BOOTBRANCH='tag:v2017.09' # conditionally change u-boot git branch/tag
KERNELBRANCH="tag:v5.4.28" #always change to this kernel tag
</code></pre>
<h2 id="user-provided-kernel-config">User provided kernel config<a class="headerlink" href="#user-provided-kernel-config" title="Permanent link">¶</a></h2>
<p>If file <code>userpatches/linux-$KERNELFAMILY-$KERNELBRANCH.config</code> exists, it will be used instead of default one from <code>config</code>. Look for the hint at the beginning of kernel compilation process to select proper config file name. Example:</p>
<pre><code>[ o.k. ] Compiling dev kernel [ @host ]
[ o.k. ] Using kernel config file [ config/linux-sunxi-dev.config ]
</code></pre>
<h2 id="user-provided-sources-config-overrides">User provided sources config overrides<a class="headerlink" href="#user-provided-sources-config-overrides" title="Permanent link">¶</a></h2>
<p>If file <code>userpatches/sources/$LINUXFAMILY.conf</code> exists, it will be used in addition to the default one from <code>config/sources</code>. Look for the hint at the beginning of compilation process to select proper config file name.
Please note that there are some exceptions for LINUXFAMILY like <code>sunxi</code> (32-bit mainline sunxi) and <code>sunxi64</code> (64-bit mainline sunxi)</p>
<p>Example:</p>
<pre><code>[ o.k. ] Adding user provided sunxi64 overrides
</code></pre>
<h2 id="user-provided-image-customization-script">User provided image customization script<a class="headerlink" href="#user-provided-image-customization-script" title="Permanent link">¶</a></h2>
<p>You can run additional commands to customize created image. Edit file:</p>
<pre><code>userpatches/customize-image.sh
</code></pre>
<p>and place your code here. You may test values of variables noted in the file to use different commands for different configurations. Those commands will be executed in a chroot environment just before closing image.</p>
<p>To add files to image easily, put them in <code>userpatches/overlay</code> and access them in <code>/tmp/overlay</code> from <code>customize-image.sh</code></p>
<h2 id="partitioning-of-the-sd-card">Partitioning of the SD card<a class="headerlink" href="#partitioning-of-the-sd-card" title="Permanent link">¶</a></h2>
<p>In case you define <code>$FIXED_IMAGE_SIZE</code> at build time the partition containing the rootfs will be made of this size. Default behaviour when this is not defined is to shrink the partition to minimum size at build time and expand it to the card’s maximum capacity at boot time (leaving an unpartitioned spare area of ~5% when the size is 4GB or less to help the SD card’s controller with wear leveling and garbage collection on old/slow cards).</p>
<p>You can prevent the partition expansion from within <code>customize-image.sh</code> by a <code>touch /root/.no_rootfs_resize</code> or configure the resize operation by either a percentage or a sector count using <code>/root/.rootfs_resize</code> (<code>50%</code> will use only half of the card’s size if the image size doesn’t exceed this or <code>3887103s</code> for example will use sector 3887103 as partition end. Values without either <code>%</code> or <code>s</code> will be ignored)</p>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="../Developer-Guide_FEL-boot/" title="FEL boot">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="../Developer-Guide_Build-Options/" title="Build Options"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span><a href="../Developer-Guide_Build-Options/" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="../Developer-Guide_FEL-boot/" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
