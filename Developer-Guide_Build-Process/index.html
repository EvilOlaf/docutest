<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Armbian team" name="author"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>What happens behind the build process? - Armbian Documentation</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet"/>
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "What happens behind the build process?";
    var mkdocs_page_input_path = "Developer-Guide_Build-Process.md";
    var mkdocs_page_url = null;
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-284946-9', 'docs.armbian.com');
      ga('send', 'pageview');
  </script>
</link><link href="../pdf/document.pdf" rel="alternate" title="PDF" type="application/pdf"/></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> Armbian Documentation</a>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="..">Home</a>
</li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Getting-Started/">Getting Started</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Quick_facts/">Quick facts</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Basic-Troubleshooting/">Troubleshooting</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Advanced-Features/">Advanced Features</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Fine-Tuning/">Fine Tuning</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Armbian-Config/">Armbian config</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Allwinner_overlays/">Allwinner DT overlays</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../User-Guide_Migration_from_Bananian/">Migration from Bananian</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Hardware Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner/">Allwinner (Generic)</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner-A20/">A10 and A20</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner-H3/">H2+ and H3</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner-H5-A64/">H5 and A64</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Allwinner-H6/">H6</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Freescale-imx6/">Freescale i.MX6</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Hardware_Marvell/">Marvell Armada</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_Build-Preparation/">Building Armbian</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_Using-Vagrant/">Building with Vagrant</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_Building-with-Docker/">Building with Docker</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_Build-Options/">Build Options</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_User-Configurations/">User Configurations</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer-Guide_FEL-boot/">FEL boot</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Contributor Process</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Process_Contribute/">Contribute</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Process_Merge-Policy/">Merge Policy</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Process_Documentation/">Documentation</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Release management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Process_Release-Model/">Model</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Release_Changelog/">Changelog</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Community_IRC/">IRC</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">Armbian Documentation</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>What happens behind the build process?</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/armbian/documentation/edit/master/docs/Developer-Guide_Build-Process.md"> Edit on Github</a>
</li>
</ul>
<hr/>
</div>
<div role="main">
<div class="section">
<h1 id="what-happens-behind-the-build-process">What happens behind the build process?<a class="headerlink" href="#what-happens-behind-the-build-process" title="Permanent link">¶</a></h1>
<h3 id="build-process-summary">Build process summary:<a class="headerlink" href="#build-process-summary" title="Permanent link">¶</a></h3>
<ul>
<li>creates development environment on top of amd64 Ubuntu 20.04 LTS,</li>
<li>downloads proven sources, applies patches on top and uses tested configurations,</li>
<li>cross-compiles universal boot loader (<strong><em>U-Boot</em></strong>), kernel and other tools and drivers,</li>
<li>packs kernel, U-Boot, dtb and root customizations into Debian packages,</li>
<li>debootstraps minimalistic Debian Buster and Ubuntu Focal into SD card images,</li>
<li>installs additional packets, applies customizations and shrinks image to its actual size.</li>
</ul>
<p>Check this image <a href="https://youtu.be/zeShf12MNLg">compiling example</a> with partial cache.</p>
<h3 id="build-process-details">Build process details:<a class="headerlink" href="#build-process-details" title="Permanent link">¶</a></h3>
<h2 id="creating-compile-environment">Creating compile environment<a class="headerlink" href="#creating-compile-environment" title="Permanent link">¶</a></h2>
<p>First things first. All necessary dependencies are downloaded and installed. This happens though both http and torrent network. Btw. having too much unused traffic? <a href="https://forum.armbian.com/topic/4198-seed-our-torrents/">Help us to reduce ours :)</a></p>
<h2 id="using-board-configuration">Using board configuration<a class="headerlink" href="#using-board-configuration" title="Permanent link">¶</a></h2>
<p>We need to get some predefined variables about selected the board. Which kernel &amp; uboot source to use, modules to load, which is the build number, do we need to have a single partition or dual with boot on fat, which extra drivers to compile out of the kernel tree …
All this stuff is predefined for each and every single supported board.</p>
<h2 id="downloading-sources">Downloading sources<a class="headerlink" href="#downloading-sources" title="Permanent link">¶</a></h2>
<p>When we know which sources to use and where they need to be the download or updated this process starts. This might take from several minutes to several hours.</p>
<h2 id="patching">Patching<a class="headerlink" href="#patching" title="Permanent link">¶</a></h2>
<p>In the patching process we are applying patches to the used sources. The process is - depending on selected board - defined in:</p>
<pre><code>lib/patch/kernel/sun7i-default
lib/patch/kernel/sunxi-dev
...
lib/patch/u-boot/u-boot-default
lib/patch/u-boot/u-boot-neo-default
...
</code></pre>
<p>Patch rules for subdirectories are: <strong>KERNEL_FAMILY-BRANCH</strong> for kernel and <strong>U-BOOT-SOURCE-BRANCH</strong> for U-Boot.</p>
<h2 id="debootstrap">Debootstrap<a class="headerlink" href="#debootstrap" title="Permanent link">¶</a></h2>
<p>Debootstrap creates fresh Debian / Ubuntu root filesystem templates or use cached under:</p>
<pre><code>output/cache/rootfs/
</code></pre>
<p>To recreate those files you need to remove them manually. 
From time to time they will be recreated anyway if Armbian updates their rootfs cache.</p>
<h2 id="kernel-install">Kernel install<a class="headerlink" href="#kernel-install" title="Permanent link">¶</a></h2>
<p>When the root filesystem is ready we need to install the kernel image with modules, board definitions and firmwares. Along with this we set the CPU frequency min/max, hostname, modules, network interfaces templates. Here is also the place to install headers and fix + native compile them on the way.</p>
<h2 id="distribution-fixes">Distribution fixes<a class="headerlink" href="#distribution-fixes" title="Permanent link">¶</a></h2>
<p>Each distribution has it’s own way of doing things:</p>
<ul>
<li>serial console</li>
<li>different packets</li>
<li>configuration locations</li>
</ul>
<h2 id="board-fixes">Board fixes<a class="headerlink" href="#board-fixes" title="Permanent link">¶</a></h2>
<p>Each board has their own tricks: <strong>different device names, firmware loaders, configuration (de)compilers, hardware configurators</strong></p>
<h2 id="desktop-installation">Desktop installation<a class="headerlink" href="#desktop-installation" title="Permanent link">¶</a></h2>
<p>You can build a desktop environment withing the image. Consider this feature as experimental. Do not expect to have working hardware acceleration since this is a very complicated task and needs individial care for different boards.</p>
<h2 id="external-applications">External applications<a class="headerlink" href="#external-applications" title="Permanent link">¶</a></h2>
<p>This place is reserved for custom applications. There is one example of application: USB redirector.</p>
<h2 id="closing-image">Closing image<a class="headerlink" href="#closing-image" title="Permanent link">¶</a></h2>
<p>There is an option to add some extra commands just before closing an image which is also automaticaly shrink to it’s actual size with some small reserve.</p>
<h2 id="directory-structure">Directory structure<a class="headerlink" href="#directory-structure" title="Permanent link">¶</a></h2>
<p>It will be something like this:</p>
<pre><code>compile.sh              compile execution script
lib/bin/                blobs, firmwares, static compiled, bootsplash
lib/config/             kernel, board, u-boot, hostapd, package list
lib/documentation/      user and developers manual
lib/patch/              collection of kernel and u-boot patches
lib/scripts/            firstrun, arm hardware info, firmware loaders
lib/LICENSE             licence description
lib/README.md           quick manual
lib/common.sh           creates environment, compiles, shrink image
lib/configuration.sh    boards presets - kernel source, config, modules, ...
lib/distributions.sh    system specific installation and fixes
lib/main.sh             user input and script calls
lib/makeboarddeb.sh     creates board support package .deb
lib/repo-update.sh      creates and updates your local repository
lib/repo-show-sh        show packets in your local repository
lib/upgrade.sh          script to upgrade older images
sources/                source code for kernel, uboot and other utilities
output/repository       repository 
output/cache            cache for root filesystem and headers compilation
output/debs             deb packeges
output/images           zip packed RAW image
userpatches/kernel      put your kernel patches here
userpatches/u-boot      put your u-boot patches here
userpatches/            put your kernel config here
</code></pre>
<h2 id="additional-info">Additional info<a class="headerlink" href="#additional-info" title="Permanent link">¶</a></h2>
<ul>
<li><a href="https://linux-sunxi.org/">Allwinner SBC community</a></li>
</ul>
</div>
</div>
<footer>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
